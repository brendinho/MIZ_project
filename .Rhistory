2021-1983
1978-17
2021-1961
source("~/GitHub/MIZ_project/refresh_all_data.R")
source("~/GitHub/MIZ_project/refresh_all_data.R")
Airport_Locations
which_PSUs(Airport_Locations[1,]$ICAO)
which_PHUs<- function(icao)
{
return(
st_intersects(
data.table(Airport_Locations)[ICAO == icao, geometry] %>% st_sf() %>% st_transform(3857),
PHU_information$geometry %>% st_sf() %>% st_transform(3857)
) %>% .[1] %>% .[[1]] %>% PHU_information[., HRUID2018]
)
}
which_PSUs(Airport_Locations[1,]$ICAO)
which_PHUs<- function(icao)
{
return(
st_intersects(
data.table(Airport_Locations)[ICAO == icao, geometry] %>% st_sf() %>% st_transform(3857),
PHU_information$geometry %>% st_sf() %>% st_transform(3857)
) %>% .[1] %>% .[[1]] %>% PHU_information[., HRUID2018]
)
}
which_PSUs(Airport_Locations[1,]$ICAO)
which_PHUs(Airport_Locations[1,]$ICAO)
which_PHUs(Airport_Locations[1:3,]$ICAO)
which_PHUs <- function(icaos)
{
return(unlist(lapply(
icaos,
\(xx) st_intersects(
data.table(Airport_Locations)[ICAO == xx, geometry] %>% st_sf() %>% st_transform(3857),
PHU_information$geometry %>% st_sf() %>% st_transform(3857)
) %>% .[1] %>% .[[1]] %>% PHU_information[., HRUID2018]
)))
}
which_PHUs(Airport_Locations[1:3,]$ICAO)
which_PHUs(Airport_Locations[29:31,]$ICAO)
which_PHUs(Airport_Locations[29:31,]$ICAO) -> x
table(x)
table(x) %>% data.table()
table(x) %>% data.table()
PSUs_with_airports <-  which_PHUs(unique(Airport_Locations$ICAO))
start_time <- Sys.time()
PSUs_with_airports <-  which_PHUs(unique(Airport_Locations$ICAO))
print(Sys.time() - start_time
)
PSUs_with_airports
PSUs_with_airports %>% lwngth
PSUs_with_airports %>% length
length(Airport_Locations)
nrow(Airport_Locations)
PSUs_with_airports %>% dtable %>% data.table
PSUs_with_airports %>% table %>% data.table
PSUs_with_airports %>% table %>% data.table %>% dplyr::rename(`.` = "HRUID2018")
PSUs_with_airports %>% table %>% data.table %>% dplyr::rename("HRUID2018"=`.`)
PSUs_with_airports %>% table %>% data.table
PSUs_with_airports %>% table %>% data.table %>% setNames("HRUID2018", "N")
PSUs_with_airports %>% table %>% data.table %>% setNames(c("HRUID2018", "N"))
?setNames
file.path(PROJECT_FOLDER, "Classifications/PHUs_hosting_airports")
PSUs_with_airports %>% table %>% data.table %>% setNames(c("HRUID2018", "N")) %>% fwrite(file.path(PROJECT_FOLDER, "Classifications/PHUs_hosting_airports"))
Total_Data_Geo
PHU_information
readRDS(file.path(PROJECT_FOLDER, "Classifications/HR_shapes.rda"))
source("~/GitHub/MIZ_project/refresh_all_data.R")
PHU_shapes
Airport_Locations <- st_read(file.path(PROJECT_FOLDER, "Airports_Aeroports_en_shape/Airports_Aeroports_en_shape.shp"))
Airport_Locations <- st_read(file.path(PROJECT_FOLDER, "Airports_Aeroports_en_shape/Airports_Aeroports_en_shape.shp"))
which_PHUs <- function(icaos)
{
return(unlist(lapply(
icaos,
\(xx) st_intersects(
data.table(Airport_Locations)[ICAO == xx, geometry] %>% st_sf() %>% st_transform(3857),
PHU_shapes$geometry %>% st_sf() %>% st_transform(3857)
) %>% .[1] %>% .[[1]] %>% PHU_information[., HRUID2018]
)))
}
start_time <- Sys.time()
PSUs_with_airports <-  which_PHUs(unique(Airport_Locations$ICAO)) %>%
table %>%
data.table %>%
setNames(c("HRUID2018", "N"))
fwrite(PSUs_with_airports, file.path(PROJECT_FOLDER, "Classifications/PHUs_hosting_airports"))
print(Sys.time() - start_time)
{
Airport_Locations <- st_read(file.path(PROJECT_FOLDER, "Airports_Aeroports_en_shape/Airports_Aeroports_en_shape.shp"))
which_PHUs <- function(icaos)
{
return(unlist(lapply(
icaos,
\(xx) st_intersects(
data.table(Airport_Locations)[ICAO == xx, geometry] %>% st_sf() %>% st_transform(3857),
PHU_shapes$geometry %>% st_sf() %>% st_transform(3857)
) %>% .[1] %>% .[[1]] %>% PHU_information[., HRUID2018]
)))
}
Airport_Locations <- st_read(file.path(PROJECT_FOLDER, "Airports_Aeroports_en_shape/Airports_Aeroports_en_shape.shp"))
which_PHUs <- function(icaos)
{
return(unlist(lapply(
icaos,
\(xx) st_intersects(
data.table(Airport_Locations)[ICAO == xx, geometry] %>% st_sf() %>% st_transform(3857),
PHU_shapes$geometry %>% st_sf() %>% st_transform(3857)
) %>% .[1] %>% .[[1]] %>% PHU_information[., HRUID2018]
)))
}
PSUs_with_airports <-  which_PHUs(unique(Airport_Locations$ICAO)) %>%
table %>%
data.table %>%
setNames(c("HRUID2018", "N"))
PSUs_with_airports <-  which_PHUs(unique(Airport_Locations$ICAO)) %>%
table %>%
data.table %>%
setNames(c("HRUID2018", "N"))
PHU_shapes
which_PHUs <- function(icaos)
{
return(unlist(lapply(
icaos,
\(xx) st_intersects(
data.table(Airport_Locations)[ICAO == xx, geometry] %>% st_sf() %>% st_transform(3857),
PHU_shapes$geometry %>% st_sf() %>% st_transform(3857)
) %>% .[1] %>% .[[1]] %>% PHU_shapes[., HRUID2018]
)))
}
start_time <- Sys.time()
PSUs_with_airports <-  which_PHUs(unique(Airport_Locations$ICAO)) %>%
table %>%
data.table %>%
setNames(c("HRUID2018", "N"))
fwrite(PSUs_with_airports, file.path(PROJECT_FOLDER, "Classifications/PHUs_hosting_airports"))
print(Sys.time() - start_time)
PSUs_with_airports
PHU_information <- Total_Data_Geo[,
lapply(.SD, sum, na=TRUE),
.SDcols = setdiff(
names(Total_Data_Geo),
c("geo_code", "geo_name", "class", "province", "HR", "HRUID2018")
),
by=.(HRUID2018, province, HR)
] %>%
merge(readRDS(file.path(PROJECT_FOLDER, "Classifications/HR_shapes.rda")), by=c("HRUID2018")) %>%
merge(PSUs_with_airports, by=c("HRUID2018"))
PSUs_with_airports %>% str
PSUs_with_airports %>% dplyr::mutate(HRUID2018 = as.numeric(HRUID2018))
PSUs_with_airports %>% dplyr::mutate(HRUID2018 = as.numeric(HRUID2018)) -> PSUs_with_airports
PHU_information <- Total_Data_Geo[,
lapply(.SD, sum, na=TRUE),
.SDcols = setdiff(
names(Total_Data_Geo),
c("geo_code", "geo_name", "class", "province", "HR", "HRUID2018")
),
by=.(HRUID2018, province, HR)
] %>%
merge(readRDS(file.path(PROJECT_FOLDER, "Classifications/HR_shapes.rda")), by=c("HRUID2018")) %>%
merge(PSUs_with_airports, by=c("HRUID2018"))
PHU_information
PHU_information <- Total_Data_Geo[,
lapply(.SD, sum, na=TRUE),
.SDcols = setdiff(
names(Total_Data_Geo),
c("geo_code", "geo_name", "class", "province", "HR", "HRUID2018")
),
by=.(HRUID2018, province, HR)
] %>%
merge(readRDS(file.path(PROJECT_FOLDER, "Classifications/HR_shapes.rda")), by=c("HRUID2018")) %>%
merge(PSUs_with_airports, by=c("HRUID2018")) %>%
st_sf()
PHU_information
